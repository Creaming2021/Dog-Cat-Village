##### TIL_20210310



# API ì—°ë™

## ìœ ìš©í•œ ì‚¬ì´íŠ¸ ë° ë„êµ¬

- JSë¥¼ ì˜ ëª¨ë¥¸ë‹¤ë©´ by ë²¨ë¡œí¼íŠ¸?   https://learnjs.vlpt.us/
- ë¦¬ì•¡íŠ¸ íŠœí† ë¦¬ì–¼ ë¬¸ì„œ by ë²¨ë¡œí¼íŠ¸?  https://react.vlpt.us/
- ì´ ì±•í„°ì—ì„œëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ Promise, async/await ì— ëŒ€í•´ì„œ ìì„¸íˆ ì´í•´í•˜ê³  ìˆì–´ì•¼ í•œë‹¤. https://learnjs.vlpt.us/async/
- REST API : https://meetup.toast.com/posts/92
- JSONPlaceholder ì—°ìŠµìš© API : https://jsonplaceholder.typicode.com/
- **React DevTools**  : ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” í¬ë¡¬ í™•ì¥í”„ë¡œê·¸ë¨.



------



## ëª©ì°¨ ë° ë‚´ìš©



### 00.ì†Œê°œ

- ë¦¬ì•¡íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ API ì—°ë™í•˜ëŠ” ë°©ë²•ì„ ë°°ìš°ëŠ” ì±•í„°
- ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ ë•Œ ë°ì´í„°ë¥¼ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ë“¤ê³  ìˆëŠ”ê²Œ ì•„ë‹ˆë¼, ë°ì´í„°ë¥¼ ë³´ì¡´ì‹œí‚¤ê³ , ë‹¤ë¥¸ ì‚¬ëŒë“¤ë„ ì¡°íšŒ í•  ìˆ˜ ìˆê²Œ í•˜ë ¤ë©´ ì„œë²„ë¥¼ ë§Œë“¤ê³  ì„œë²„ì˜ API ë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë¥¼ ì½ê³  ì¨ì•¼ í•œë‹¤.
- ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì£¼ë¡œ Redux ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ Redux ë¯¸ë“¤ì›¨ì–´ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤. ì´ ë„êµ¬ë“¤ì´ API ì—°ë™ì— í•„ìˆ˜ì ì¸ ìš”ì†ŒëŠ” ì•„ë‹ˆë‹¤.
- ì´ë²ˆì¥ì—ì„œëŠ” Redux ì—†ì´ ì»´í¬ë„ŒíŠ¸ì—ì„œ API ì—°ë™í•˜ëŠ” ë²•ì„ ë°°ìš´ë‹¤.
- **ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë¹„ë™ê¸° ì²˜ë¦¬ì— ëŒ€í•œ ê¸°ë³¸ì ì¸ ê°œë…ì„ ìˆ™ì§€í•´ì•¼í•˜ê³  Promise, async / await ì— ëŒ€í•´ ìˆ™ì§€í•˜ê³  ì´ ì±•í„°ë¥¼ ê³µë¶€í•  ê²ƒ.**



### 01. API ì—°ë™ì˜ ê¸°ë³¸

#### API í˜¸ì¶œì„ ìœ„í•œ axios ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

```jsx
yarn add axios
```

- `axios` ë¥¼ ì‚¬ìš©í•´ì„œ GET, PUT, POST, DELETE ë“±ì˜ ë©”ì„œë“œë¡œ API ìš”ì²­ì„ í•  ìˆ˜ ìˆë‹¤.

- ë§Œì•½ ì´ ë©”ì„œë“œë“¤ì— ëŒ€í•´ ì˜ ëª¨ë¥´ëŠ” ê²½ìš° â€”> 

  REST API

  - REST API ë¥¼ ì‚¬ìš©í•˜ë©´ í•˜ê³  ì‹¶ì€ ì‘ì—…ì— ë”°ë¼ ë‹¤ë¥¸ ë©”ì„œë“œë¡œ ìš”ì²­ì„ í•  ìˆ˜ ìˆë‹¤.

    1. GET :  ë°ì´í„° ì¡°íšŒ
    2. POST :  ë°ì´í„° ë“±ë¡
    3. PUT :  ë°ì´í„° ìˆ˜ì •
    4. DELETE :  ë°ì´í„° ì œê±°

    ìœ„ ë©”ì„œë“œ ì™¸ì—ë„ PATCH, HEAD ì™€ ê°™ì€ ë©”ì„œë“œë“¤ë„ ìˆë‹¤.

#### `axios` ì˜ ì‚¬ìš©ë²•

```jsx
import axios from 'axios';

axios.**get**('/users/1');
```

- **method** : get ì´ ìœ„ì¹˜í•œ ìë¦¬ì— ì†Œë¬¸ìë¡œ ë©”ì„œë“œ ì´ë¦„ì„ ë„£ëŠ”ë‹¤.

  ex) ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ë“±ë¡í•˜ê³  ì‹¶ë‹¤ë©´ `axios.post();`

- íŒŒë¼ë¯¸í„°ì—ëŠ” API ì£¼ì†Œë¥¼ ë„£ëŠ”ë‹¤.`

  `axios.post()` ë¡œ ë°ì´í„°ë¥¼ ë“±ë¡í•  ë•ŒëŠ” ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ë“±ë¡í•˜ê³ ì í•˜ëŠ” ì •ë³´ë¥¼ ë„£ì„ ìˆ˜ ìˆë‹¤.

  ```jsx
  axios.post('/users', {
    username: 'blabla',
    name: 'blabla'
  });
  ```

#### API ì—°ë™ ì‹¤ìŠµ

- JSONPlace
  - https://jsonplaceholder.typicode.com/
  - https://jsonplaceholder.typicode.com/users (ì‚¬ìš©)

##### useStateì™€ useEffectë¡œ ë°ì´í„° ë¡œë”©í•˜ê¸°

- `useState` ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³  `useEffect` ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ë˜ëŠ” ì‹œì ì— ìš”ì²­ì„ ì‹œì‘í•˜ëŠ” ì‘ì—…
- ğŸ¤© ìš”ì²­ì— ëŒ€í•œ ìƒíƒœë¥¼ ê´€ë¦¬ í•  ë•Œì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì´ 3ê°€ì§€ ìƒíƒœë¥¼ ê´€ë¦¬í•´ ì£¼ì–´ì•¼ í•œë‹¤. ğŸ¤©
  1. **ìš”ì²­ì˜ ê²°ê³¼**
  2. **ë¡œë”© ìƒíƒœ**
  3. **ì—ëŸ¬**

#### Users.js

```jsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';

function Users() {
  const [users, setUsers] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchUsers = async () => {
      try {
        // ìš”ì²­ì´ ì‹œì‘ í•  ë•Œì—ëŠ” error ì™€ users ë¥¼ ì´ˆê¸°í™”í•˜ê³ 
        setError(null);
        setUsers(null);
        // loading ìƒíƒœë¥¼ true ë¡œ ë°”ê¿‰ë‹ˆë‹¤.
        setLoading(true);
        const response = await axios.get(
          '<https://jsonplaceholder.typicode.com/users>'
					// '<https://jsonplaceholder.typicode.com/users/ì—ëŸ¬ë°œìƒí™•ì¸ìš©>'
        );
        setUsers(response.data); // ë°ì´í„°ëŠ” response.data ì•ˆì— ë“¤ì–´ìˆìŠµë‹ˆë‹¤.
      } catch (e) {
        setError(e);
      }
      setLoading(false);
    };

    fetchUsers();
  }, []);

  if (loading) return <div>ë¡œë”©ì¤‘..</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</div>;
  if (!users) return null;
  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>
          {user.username} ({user.name})
        </li>
      ))}
    </ul>
  );
}

export default Users;
```

- `useEffect` ì— ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¡œ ë“±ë¡í•˜ëŠ” í•¨ìˆ˜ì—ëŠ” `async` ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ `async` ë¥¼ ì‚¬ìš©í•˜ëŠ” ìƒˆë¡œìš´ í•¨ìˆ˜ë¥¼ ì„ ì–¸í•´ì£¼ì–´ì•¼ í•œë‹¤.

##### ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ API ìš”ì²­í•˜ê¸°

- ìœ„ ì½”ë“œì— ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ API ì¬ìš”ì²­í•˜ëŠ” ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°
- **Users.js**

```jsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';

function Users() {
  const [users, setUsers] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const fetchUsers = async () => {
    try {
      // ìš”ì²­ì´ ì‹œì‘ í•  ë•Œì—ëŠ” error ì™€ users ë¥¼ ì´ˆê¸°í™”í•˜ê³ 
      setError(null);
      setUsers(null);
      // loading ìƒíƒœë¥¼ true ë¡œ ë°”ê¿‰ë‹ˆë‹¤.
      setLoading(true);
      const response = await axios.get(
        '<https://jsonplaceholder.typicode.com/users>'
      );
      setUsers(response.data); // ë°ì´í„°ëŠ” response.data ì•ˆì— ë“¤ì–´ìˆìŠµë‹ˆë‹¤.
    } catch (e) {
      setError(e);
    }
    setLoading(false);
  };

  useEffect(() => {
    fetchUsers();
  }, []);

  if (loading) return <div>ë¡œë”©ì¤‘..</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</div>;
  if (!users) return null;
  return (
    <>
      <ul>
        {users.map(user => (
          <li key={user.id}>
            {user.username} ({user.name})
          </li>
        ))}
      </ul>
      <button onClick={fetchUsers}>ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </>
  );
}

export default Users;
```