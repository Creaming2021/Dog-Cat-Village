##### TIL_20210310



# API 연동

## 유용한 사이트 및 도구

- JS를 잘 모른다면 by 벨로퍼트?   https://learnjs.vlpt.us/
- 리액트 튜토리얼 문서 by 벨로퍼트?  https://react.vlpt.us/
- 이 챕터에서는 자바스크립트 Promise, async/await 에 대해서 자세히 이해하고 있어야 한다. https://learnjs.vlpt.us/async/
- REST API : https://meetup.toast.com/posts/92
- JSONPlaceholder 연습용 API : https://jsonplaceholder.typicode.com/
- **React DevTools**  : 어떤 컴포넌트가 렌더링되고 있는지 확인할 수 있는 크롬 확장프로그램.



------



## 목차 및 내용



### 00.소개

- 리액트 애플리케이션에서 API 연동하는 방법을 배우는 챕터
- 웹 애플리케이션을 만들 때 데이터를 브라우저에서만 들고 있는게 아니라, 데이터를 보존시키고, 다른 사람들도 조회 할 수 있게 하려면 서버를 만들고 서버의 API 를 사용해서 데이터를 읽고 써야 한다.
- 실제 프로젝트에서는 주로 Redux 라는 라이브러리와 Redux 미들웨어를 함께 사용하여 구현하는 경우가 많다. 이 도구들이 API 연동에 필수적인 요소는 아니다.
- 이번장에서는 Redux 없이 컴포넌트에서 API 연동하는 법을 배운다.
- **자바스크립트의 비동기 처리에 대한 기본적인 개념을 숙지해야하고 Promise, async / await 에 대해 숙지하고 이 챕터를 공부할 것.**



### 01. API 연동의 기본

#### API 호출을 위한 axios 라이브러리 설치

```jsx
yarn add axios
```

- `axios` 를 사용해서 GET, PUT, POST, DELETE 등의 메서드로 API 요청을 할 수 있다.

- 만약 이 메서드들에 대해 잘 모르는 경우 —> 

  REST API

  - REST API 를 사용하면 하고 싶은 작업에 따라 다른 메서드로 요청을 할 수 있다.

    1. GET :  데이터 조회
    2. POST :  데이터 등록
    3. PUT :  데이터 수정
    4. DELETE :  데이터 제거

    위 메서드 외에도 PATCH, HEAD 와 같은 메서드들도 있다.

#### `axios` 의 사용법

```jsx
import axios from 'axios';

axios.**get**('/users/1');
```

- **method** : get 이 위치한 자리에 소문자로 메서드 이름을 넣는다.

  ex) 새로운 데이터를 등록하고 싶다면 `axios.post();`

- 파라미터에는 API 주소를 넣는다.`

  `axios.post()` 로 데이터를 등록할 때는 두번째 파라미터에 등록하고자 하는 정보를 넣을 수 있다.

  ```jsx
  axios.post('/users', {
    username: 'blabla',
    name: 'blabla'
  });
  ```

#### API 연동 실습

- JSONPlace
  - https://jsonplaceholder.typicode.com/
  - https://jsonplaceholder.typicode.com/users (사용)

##### useState와 useEffect로 데이터 로딩하기

- `useState` 를 사용하여 요청 상태를 관리하고 `useEffect` 를 사용하여 컴포넌트가 렌더링되는 시점에 요청을 시작하는 작업
- 🤩 요청에 대한 상태를 관리 할 때에는 다음과 같이 총 3가지 상태를 관리해 주어야 한다. 🤩
  1. **요청의 결과**
  2. **로딩 상태**
  3. **에러**

#### Users.js

```jsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';

function Users() {
  const [users, setUsers] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchUsers = async () => {
      try {
        // 요청이 시작 할 때에는 error 와 users 를 초기화하고
        setError(null);
        setUsers(null);
        // loading 상태를 true 로 바꿉니다.
        setLoading(true);
        const response = await axios.get(
          '<https://jsonplaceholder.typicode.com/users>'
					// '<https://jsonplaceholder.typicode.com/users/에러발생확인용>'
        );
        setUsers(response.data); // 데이터는 response.data 안에 들어있습니다.
      } catch (e) {
        setError(e);
      }
      setLoading(false);
    };

    fetchUsers();
  }, []);

  if (loading) return <div>로딩중..</div>;
  if (error) return <div>에러가 발생했습니다</div>;
  if (!users) return null;
  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>
          {user.username} ({user.name})
        </li>
      ))}
    </ul>
  );
}

export default Users;
```

- `useEffect` 에 첫번째 파라미터로 등록하는 함수에는 `async` 를 사용할 수 없기 때문에 함수 내부에서 `async` 를 사용하는 새로운 함수를 선언해주어야 한다.

##### 버튼을 눌러서 API 요청하기

- 위 코드에 버튼을 눌러서 API 재요청하는 기능 구현하기
- **Users.js**

```jsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';

function Users() {
  const [users, setUsers] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const fetchUsers = async () => {
    try {
      // 요청이 시작 할 때에는 error 와 users 를 초기화하고
      setError(null);
      setUsers(null);
      // loading 상태를 true 로 바꿉니다.
      setLoading(true);
      const response = await axios.get(
        '<https://jsonplaceholder.typicode.com/users>'
      );
      setUsers(response.data); // 데이터는 response.data 안에 들어있습니다.
    } catch (e) {
      setError(e);
    }
    setLoading(false);
  };

  useEffect(() => {
    fetchUsers();
  }, []);

  if (loading) return <div>로딩중..</div>;
  if (error) return <div>에러가 발생했습니다</div>;
  if (!users) return null;
  return (
    <>
      <ul>
        {users.map(user => (
          <li key={user.id}>
            {user.username} ({user.name})
          </li>
        ))}
      </ul>
      <button onClick={fetchUsers}>다시 불러오기</button>
    </>
  );
}

export default Users;
```